<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ê´‘ì¤‘í•™êµ ê²°ì‹œì ì¸ì •ì  ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- âœ… Excel ì €ì¥ ê¸°ëŠ¥ ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .selected { 
            @apply ring-4 ring-blue-300 ring-opacity-50 transform scale-105; 
        }
        .btn-hover:hover { 
            @apply transform scale-105 transition-all duration-200; 
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">ğŸ« ì¼ê´‘ì¤‘í•™êµ ê²°ì‹œì ì¸ì •ì  ê³„ì‚°ê¸°</h1>
            <p class="text-gray-600 text-center mb-8">ì¸ì •ì  ê³„ì‚°ì„ ë³´ë‹¤ í¸ë¦¬í•˜ê²ŒğŸ˜Š</p>
            
            <!-- í•™ë…„/ê³¼ëª© ì„ íƒ -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ‘¤ í•™ë…„/ê³¼ëª© ì„ íƒ</h2>
                <div class="bg-gray-50 rounded-xl p-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í•™ë…„</label>
                            <select id="student-grade" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">ì„ íƒ</option>
                                <option value="1">1í•™ë…„</option>
                                <option value="2">2í•™ë…„</option>
                                <option value="3">3í•™ë…„</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê³¼ëª©</label>
                            <select id="student-subject" onchange="handleSubjectChange()" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">ì„ íƒ</option>
                                <option value="êµ­ì–´">êµ­ì–´</option>
                                <option value="ì˜ì–´">ì˜ì–´</option>
                                <option value="ìˆ˜í•™">ìˆ˜í•™</option>
                                <option value="ì‚¬íšŒ">ì‚¬íšŒ</option>
                                <option value="ê³¼í•™">ê³¼í•™</option>
                                <option value="ë„ë•">ë„ë•</option>
                                <option value="í•œë¬¸">í•œë¬¸</option>
                                <option value="ì—­ì‚¬">ì—­ì‚¬</option>
                                <option value="ê¸°ìˆ ê°€ì •">ê¸°ìˆ ê°€ì •</option>
                                <option value="ì •ë³´">ì •ë³´</option>
                                <option value="ìŒì•…">ìŒì•…</option>
                                <option value="ë¯¸ìˆ ">ë¯¸ìˆ </option>
                                <option value="ì²´ìœ¡">ì²´ìœ¡</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í‰ê·  ì ìˆ˜ ê´€ë¦¬ -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“Š í‰ê·  ì ìˆ˜ ê´€ë¦¬</h2>
                <div class="bg-blue-50 rounded-xl p-6 mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-blue-800 text-sm">
                            <strong>ğŸ’¡ ì•ˆë‚´:</strong> í•œ ë²ˆ ì…ë ¥í•œ í‰ê·  ì ìˆ˜ëŠ” ìë™ìœ¼ë¡œ ì €ì¥ë˜ì–´ ë‹¤ìŒ ê³„ì‚°ì—ì„œ ì¬ì‚¬ìš©ë©ë‹ˆë‹¤.
                        </p>
                        <button type="button" onclick="clearAllAverages()" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200">
                            ì „ì²´ ì´ˆê¸°í™”
                        </button>
                    </div>
                    
                    <!-- ì§€í•„ê³ ì‚¬ í‰ê·  -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="written-exam-averages">
                        <div class="bg-white rounded-lg p-4 border border-blue-200">
                            <h3 class="font-semibold text-blue-800 mb-2">ì¤‘ê°„ê³ ì‚¬ í‰ê· </h3>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-midterm-avg" placeholder="ì˜ˆ: 75.5" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       onchange="saveAverage('midterm', this.value)">
                                <button type="button" onclick="clearAverage('midterm')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-blue-200">
                            <h3 class="font-semibold text-blue-800 mb-2">ê¸°ë§ê³ ì‚¬ í‰ê· </h3>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-final-avg" placeholder="ì˜ˆ: 78.2" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       onchange="saveAverage('final', this.value)">
                                <button type="button" onclick="clearAverage('final')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì˜ì–´ë“£ê¸° í‰ê·  (ì˜ì–´ ê³¼ëª© ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                    <div class="grid grid-cols-1 gap-4 mb-6 hidden" id="english-listening-average">
                        <div class="bg-white rounded-lg p-4 border border-orange-200">
                            <h3 class="font-semibold text-orange-800 mb-2">ğŸ§ ì˜ì–´ë“£ê¸° í‰ê· </h3>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-listening-avg" placeholder="ì˜ˆ: 82.5" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                                       onchange="saveAverage('englishListening', this.value)">
                                <button type="button" onclick="clearAverage('englishListening')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìˆ˜í–‰í‰ê°€ í‰ê·  (ìŒì•…/ë¯¸ìˆ /ì²´ìœ¡ ê³¼ëª© ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 hidden" id="performance-averages">
                        <div class="bg-white rounded-lg p-4 border border-purple-200">
                            <h3 class="font-semibold text-purple-800 mb-2">ğŸ¨ <span id="performance1-title">ìˆ˜í–‰í‰ê°€ 1</span></h3>
                            <div class="mb-2">
                                <input type="text" id="saved-performance1-name" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì‹¤ê¸°)" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="savePerformanceAreaName('performance1', this.value)">
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-performance1-avg" placeholder="ì˜ˆ: 85.0" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="saveAverage('performance1', this.value)">
                                <button type="button" onclick="clearPerformanceArea('performance1')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-purple-200">
                            <h3 class="font-semibold text-purple-800 mb-2">ğŸ¨ <span id="performance2-title">ìˆ˜í–‰í‰ê°€ 2</span></h3>
                            <div class="mb-2">
                                <input type="text" id="saved-performance2-name" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì´ë¡ )" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="savePerformanceAreaName('performance2', this.value)">
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-performance2-avg" placeholder="ì˜ˆ: 87.5" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="saveAverage('performance2', this.value)">
                                <button type="button" onclick="clearPerformanceArea('performance2')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-purple-200">
                            <h3 class="font-semibold text-purple-800 mb-2">ğŸ¨ <span id="performance3-title">ìˆ˜í–‰í‰ê°€ 3</span></h3>
                            <div class="mb-2">
                                <input type="text" id="saved-performance3-name" placeholder="ì˜ì—­ëª… (ì˜ˆ: íƒœë„)" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="savePerformanceAreaName('performance3', this.value)">
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" id="saved-performance3-avg" placeholder="ì˜ˆ: 83.2" 
                                       class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       onchange="saveAverage('performance3', this.value)">
                                <button type="button" onclick="clearPerformanceArea('performance3')" 
                                        class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>


                </div>
            </div>

            <!-- í•™ìƒ ì •ë³´ ì…ë ¥ -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ‘¤ í•™ìƒ ì •ë³´</h2>
                <div class="bg-gray-50 rounded-xl p-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë°˜</label>
                            <input type="number" id="student-class" placeholder="ì˜ˆ: 3" min="1" max="20"
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë²ˆí˜¸</label>
                            <input type="number" id="student-number" placeholder="ì˜ˆ: 15" min="1" max="50"
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                            <input type="text" id="student-name" placeholder="ì˜ˆ: í™ê¸¸ë™"
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì‹œí—˜ ìœ í˜• ì„ íƒ -->
            <div id="exam-type-section" class="mb-8">
                <label class="block text-lg font-semibold text-gray-700 mb-4">ê²°ì‹œí•œ ì‹œí—˜ ìœ í˜•</label>
                <div id="exam-type-buttons" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button type="button" onclick="selectExamType('midterm')" id="midterm-btn" 
                            class="btn-hover bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium py-4 px-6 rounded-xl border-2 border-blue-200 transition-all duration-200">
                        ì¤‘ê°„ê³ ì‚¬
                    </button>
                    <button type="button" onclick="selectExamType('final')" id="final-btn" 
                            class="btn-hover bg-green-100 hover:bg-green-200 text-green-800 font-medium py-4 px-6 rounded-xl border-2 border-green-200 transition-all duration-200">
                        ê¸°ë§ê³ ì‚¬
                    </button>
                    <button type="button" onclick="selectExamType('performance')" id="performance-btn" 
                            class="btn-hover bg-purple-100 hover:bg-purple-200 text-purple-800 font-medium py-4 px-6 rounded-xl border-2 border-purple-200 transition-all duration-200">
                        ìˆ˜í–‰í‰ê°€
                    </button>
                    <button type="button" onclick="selectExamType('english-listening')" id="english-listening-btn" 
                            class="btn-hover bg-orange-100 hover:bg-orange-200 text-orange-800 font-medium py-4 px-6 rounded-xl border-2 border-orange-200 transition-all duration-200 hidden">
                        ğŸ§ ì˜ì–´ë“£ê¸°
                    </button>
                </div>
                <div id="performance-only-notice" class="hidden mt-4 bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <p class="text-purple-800 text-sm">
                        <strong>ğŸ’¡ ì•ˆë‚´:</strong> ì„ íƒí•˜ì‹  ê³¼ëª©ì€ ìˆ˜í–‰í‰ê°€ë§Œ ì‹¤ì‹œë˜ëŠ” ê³¼ëª©ì…ë‹ˆë‹¤.
                    </p>
                </div>
                <div id="english-listening-notice" class="hidden mt-4 bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <p class="text-orange-800 text-sm">
                        <strong>ğŸ§ ì•ˆë‚´:</strong> ì˜ì–´ ê³¼ëª©ì—ì„œëŠ” ì˜ì–´ë“£ê¸° í‰ê°€ ì¸ì •ì ë„ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <!-- ê²°ì‹œ ì‚¬ìœ  ì„ íƒ -->
            <div id="absence-reason" class="mb-8 hidden">
                <label class="block text-lg font-semibold text-gray-700 mb-4">ê²°ì‹œ ì‚¬ìœ </label>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button type="button" onclick="selectAbsenceReason('sick')" id="sick-btn" 
                            class="btn-hover bg-red-100 hover:bg-red-200 text-red-800 font-medium py-4 px-6 rounded-xl border-2 border-red-200 transition-all duration-200">
                        <div class="text-center">
                            <div class="font-semibold">ë³‘ê²°</div>
                            <div class="text-sm">80% ì¸ì •</div>
                        </div>
                    </button>
                    <button type="button" onclick="selectAbsenceReason('approved')" id="approved-btn" 
                            class="btn-hover bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium py-4 px-6 rounded-xl border-2 border-blue-200 transition-all duration-200">
                        <div class="text-center">
                            <div class="font-semibold">ì¸ì •ê²°</div>
                            <div class="text-sm">100% ì¸ì •</div>
                        </div>
                    </button>
                    <button type="button" onclick="selectAbsenceReason('unapproved')" id="unapproved-btn" 
                            class="btn-hover bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-4 px-6 rounded-xl border-2 border-gray-200 transition-all duration-200">
                        <div class="text-center">
                            <div class="font-semibold">ë¯¸ì¸ì •ê²°</div>
                            <div class="text-sm">ìµœí•˜ì -1ì </div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- ê³„ì‚° ë°©ì‹ ì„ íƒ -->
            <div id="calculation-method" class="mb-8 hidden">
                <label class="block text-lg font-semibold text-gray-700 mb-4">ê³„ì‚° ë°©ì‹ ì„ íƒ</label>
                <div id="method-options" class="space-y-3">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì…ë ¥ í¼ -->
            <div id="input-form" class="mb-8 hidden">
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h3>
                    <div id="input-fields" class="space-y-4">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                    <button type="button" onclick="calculateScore()" 
                            class="w-full mt-6 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105">
                        ì¸ì •ì  ê³„ì‚°í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div id="result" class="hidden">
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-green-800">ğŸ“Š ê³„ì‚° ê²°ê³¼</h3>
                       <div class="space-x-2">
    <button type="button" onclick="copyResults()" 
            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
        ë³µì‚¬í•˜ê¸°
    </button>
    <!-- âœ… Excel ì €ì¥ ë²„íŠ¼ ì¶”ê°€ -->
    <button type="button" onclick="downloadXLSX()" 
            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
        Excel ì €ì¥
    </button>
    <button type="button" onclick="clearResults()" 
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
        ì „ì²´ ì‚­ì œ
    </button>
</div>

                    </div>
                    <div class="overflow-x-auto">
                        <table id="results-table" class="w-full border-collapse border border-gray-300 bg-white rounded-lg overflow-hidden shadow-sm">
                            <thead>
                                <tr class="bg-green-100">
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ë²ˆí˜¸</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">í•™ë…„</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ë°˜</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ë²ˆí˜¸</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì´ë¦„</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ê³¼ëª©</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ê²°ì‹œì‹œí—˜</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì„¸ë¶€ëª…</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ê²°ì‹œì‚¬ìœ </th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì¸ì •ë¹„ìœ¨</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì‚°ì¶œê¸°ì¤€</th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ê¸°ì¤€ì </th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì¸ì •ì </th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ë¹„ê³ </th>
                                    <th class="border border-gray-300 px-3 py-2 text-center font-semibold text-green-800 text-sm">ì‚­ì œ</th>
                                </tr>
                            </thead>
                            <tbody id="results-tbody">
                                <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ëˆ„ì ë©ë‹ˆë‹¤ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê³„ì‚° ê³µì‹ ì•ˆë‚´ ë²„íŠ¼ -->
        <div class="text-center">
            <button type="button" onclick="openFormulaModal()" 
                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all duration-200 border border-gray-300">
                ğŸ“‹ ê³„ì‚° ê³µì‹ ì•ˆë‚´ ë³´ê¸°
            </button>
        </div>
    </div>

    <!-- ê³„ì‚°ê¸° ëª¨ë‹¬ -->
    <div id="calculator-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 id="calculator-title" class="text-lg font-semibold text-gray-800">í‰ê·  ê³„ì‚°ê¸°</h3>
                <button type="button" onclick="closeCalculator()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="calculator-content">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" onclick="closeCalculator()" 
                        class="px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200">
                    ì·¨ì†Œ
                </button>
                <button type="button" onclick="applyCalculation()" 
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200">
                    ì ìš©
                </button>
            </div>
        </div>
    </div>

    <!-- ê³„ì‚° ê³µì‹ ì•ˆë‚´ ëª¨ë‹¬ -->
    <div id="formula-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ğŸ“‹ ê³„ì‚° ê³µì‹ ì•ˆë‚´</h3>
                <button type="button" onclick="closeFormulaModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 mb-6">
                <h3 class="font-semibold text-yellow-800 mb-3">ğŸ¯ ê²°ì‹œ ì‚¬ìœ ë³„ ì¸ì • ë¹„ìœ¨</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="text-center p-3 bg-red-100 rounded-lg">
                        <div class="font-semibold text-red-800">ë³‘ê²°</div>
                        <div class="text-red-600">ê³„ì‚°ëœ ì ìˆ˜ì˜ 80%</div>
                    </div>
                    <div class="text-center p-3 bg-blue-100 rounded-lg">
                        <div class="font-semibold text-blue-800">ì¸ì •ê²°</div>
                        <div class="text-blue-600">ê³„ì‚°ëœ ì ìˆ˜ì˜ 100%</div>
                    </div>
                    <div class="text-center p-3 bg-gray-100 rounded-lg">
                        <div class="font-semibold text-gray-800">ë¯¸ì¸ì •ê²°</div>
                        <div class="text-gray-600">ìµœí•˜ì  - 1ì </div>
                    </div>
                </div>
            </div>

            <div class="bg-green-50 border-2 border-green-200 rounded-xl p-4 mb-6">
                <h3 class="font-semibold text-green-800 mb-3">ğŸ“ ìˆ˜í–‰í‰ê°€ ì¸ì •ì  ê³„ì‚° ì˜ˆì‹œ</h3>
                <div class="text-sm text-green-700 space-y-2">
                    <p><strong>ìƒí™©:</strong> êµ­ì–´ ìˆ˜í–‰í‰ê°€ A, B, C ì˜ì—­ ì¤‘ Aì˜ì—­ì„ ê²°ì‹œí•œ ê²½ìš°</p>
                    <p><strong>í•´ë‹¹ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜:</strong> Bì˜ì—­ 85ì , Cì˜ì—­ 90ì  â†’ í‰ê·  87.5ì </p>
                    <p><strong>ì „ì²´ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ í‰ê· :</strong> Bì˜ì—­ í‰ê·  80ì , Cì˜ì—­ í‰ê·  82ì  â†’ í‰ê·  81ì </p>
                    <p><strong>ì „ì²´ í•™ìƒì˜ ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ í‰ê· :</strong> Aì˜ì—­ í‰ê·  78ì </p>
                    <p><strong>ê³„ì‚°:</strong> 87.5 Ã— (78 Ã· 81) Ã— ì¸ì •ë¹„ìœ¨ = 84.26 Ã— ì¸ì •ë¹„ìœ¨</p>
                </div>
            </div>

            <div class="space-y-6">
                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="font-semibold text-blue-800 mb-2">ì¤‘ê°„ê³ ì‚¬ ì¸ì •ì </h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ê¸°ë§ê³ ì‚¬ ì„±ì  ìˆìŒ: (ê¸°ë§ì ìˆ˜ Ã· ê¸°ë§í‰ê· ) Ã— ì¤‘ê°„í‰ê·  Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ìˆ˜í–‰í‰ê°€ë§Œ ìˆìŒ: (ìˆ˜í–‰ì ìˆ˜ Ã· ìˆ˜í–‰í‰ê· ) Ã— ì¤‘ê°„í‰ê·  Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ì„±ì  ì—†ìŒ: ì¤‘ê°„ê³ ì‚¬ ìµœí•˜ì  - 1ì </li>
                    </ul>
                </div>
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="font-semibold text-green-800 mb-2">ê¸°ë§ê³ ì‚¬ ì¸ì •ì </h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ì¤‘ê°„ê³ ì‚¬ ì„±ì  ìˆìŒ: (ì¤‘ê°„ì ìˆ˜ Ã· ì¤‘ê°„í‰ê· ) Ã— ê¸°ë§í‰ê·  Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ìˆ˜í–‰í‰ê°€ë§Œ ìˆìŒ: (ìˆ˜í–‰ì ìˆ˜ Ã· ìˆ˜í–‰í‰ê· ) Ã— ê¸°ë§í‰ê·  Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ì„±ì  ì—†ìŒ: ê¸°ë§ê³ ì‚¬ ìµœí•˜ì  - 1ì </li>
                    </ul>
                </div>
                <div class="border-l-4 border-purple-500 pl-4">
                    <h3 class="font-semibold text-purple-800 mb-2">ìˆ˜í–‰í‰ê°€ ì¸ì •ì </h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ìˆìŒ: í•™ìƒì˜ ë‹¤ë¥¸ì˜ì—­ í‰ê· ì ìˆ˜ Ã— (ê²°ì‹œì˜ì—­ ì „ì²´í‰ê·  Ã· ë‹¤ë¥¸ì˜ì—­ ì „ì²´í‰ê· ) Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ì§€í•„í‰ê°€ë§Œ ìˆìŒ: í•™ìƒì˜ ì§€í•„í‰ê°€ì ìˆ˜ Ã— (ìˆ˜í–‰í‰ê°€ ì „ì²´í‰ê·  Ã· ì§€í•„í‰ê°€ ì „ì²´í‰ê· ) Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ì„±ì  ì—†ìŒ: ìˆ˜í–‰í‰ê°€ ìµœí•˜ì  - 1ì </li>
                    </ul>
                </div>
                <div class="border-l-4 border-orange-500 pl-4">
                    <h3 class="font-semibold text-orange-800 mb-2">ì˜ì–´ë“£ê¸° í‰ê°€ ì¸ì •ì </h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ì§€í•„ê³ ì‚¬ ì„±ì  ìˆìŒ: (í•™ìƒ ì˜ì–´ì§€í•„ì ìˆ˜ Ã· ì˜ì–´ì§€í•„í‰ê· ) Ã— ì˜ì–´ë“£ê¸°í‰ê·  Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ìˆ˜í–‰í‰ê°€ë§Œ ìˆìŒ: í•™ìƒ ìˆ˜í–‰í‰ê· ì ìˆ˜ Ã— (ì˜ì–´ë“£ê¸°í‰ê·  Ã· ì˜ì–´ë“£ê¸°ì œì™¸ ìˆ˜í–‰í‰ê· ) Ã— ì¸ì •ë¹„ìœ¨</li>
                        <li>â€¢ ì„±ì  ì—†ìŒ: ì˜ì–´ë“£ê¸° ìµœí•˜ì  - 1ì </li>
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end mt-6">
                <button type="button" onclick="closeFormulaModal()" 
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200">
                    í™•ì¸
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentExamType = '';
        let currentMethod = '';
        let currentAbsenceReason = '';
        let isPerformanceOnlySubject = false;
        let resultCounter = 0;
        let resultsData = [];
        let currentCalculatorTarget = '';
        let currentCalculatorType = '';
        let calculatorScores = [];
        
        // ì €ì¥ëœ í‰ê·  ì ìˆ˜ë“¤
        let savedAverages = {
            midterm: null,
            final: null,
            performance: {},
            englishListening: null,
            performance1: null,
            performance2: null,
            performance3: null
        };
        
        // ì €ì¥ëœ ìˆ˜í–‰í‰ê°€ ì˜ì—­ëª…ë“¤
        let savedPerformanceAreaNames = {
            performance1: null,
            performance2: null,
            performance3: null
        };



        function handleSubjectChange() {
            const subject = document.getElementById('student-subject').value;
            const performanceOnlySubjects = ['ìŒì•…', 'ë¯¸ìˆ ', 'ì²´ìœ¡'];
            
            isPerformanceOnlySubject = performanceOnlySubjects.includes(subject);
            
            const midtermBtn = document.getElementById('midterm-btn');
            const finalBtn = document.getElementById('final-btn');
            const englishListeningBtn = document.getElementById('english-listening-btn');
            const performanceNotice = document.getElementById('performance-only-notice');
            const englishNotice = document.getElementById('english-listening-notice');
            const examTypeButtons = document.getElementById('exam-type-buttons');
            const englishListeningAverage = document.getElementById('english-listening-average');
            const writtenExamAverages = document.getElementById('written-exam-averages');
            const performanceAverages = document.getElementById('performance-averages');
            
            // ì˜ì–´ë“£ê¸° ê´€ë ¨ í‘œì‹œ/ìˆ¨ê¹€
            if (subject === 'ì˜ì–´') {
                englishListeningBtn.classList.remove('hidden');
                englishNotice.classList.remove('hidden');
                englishListeningAverage.classList.remove('hidden');
                examTypeButtons.className = 'grid grid-cols-1 md:grid-cols-4 gap-4';
            } else {
                englishListeningBtn.classList.add('hidden');
                englishNotice.classList.add('hidden');
                englishListeningAverage.classList.add('hidden');
                examTypeButtons.className = 'grid grid-cols-1 md:grid-cols-3 gap-4';
            }
            
            // í‰ê·  ì ìˆ˜ ê´€ë¦¬ ì˜ì—­ í‘œì‹œ/ìˆ¨ê¹€
            if (isPerformanceOnlySubject) {
                writtenExamAverages.classList.add('hidden');
                performanceAverages.classList.remove('hidden');
                midtermBtn.disabled = true;
                finalBtn.disabled = true;
                midtermBtn.classList.add('opacity-50', 'cursor-not-allowed');
                finalBtn.classList.add('opacity-50', 'cursor-not-allowed');
                performanceNotice.classList.remove('hidden');
                selectExamType('performance');
            } else {
                writtenExamAverages.classList.remove('hidden');
                performanceAverages.classList.add('hidden');
                midtermBtn.disabled = false;
                finalBtn.disabled = false;
                midtermBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                finalBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                performanceNotice.classList.add('hidden');
                resetExamTypeSelection();
            }
            

        }

        function resetExamTypeSelection() {
            currentExamType = '';
            currentMethod = '';
            currentAbsenceReason = '';
            
            document.querySelectorAll('.btn-hover').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.getElementById('absence-reason').classList.add('hidden');
            document.getElementById('calculation-method').classList.add('hidden');
            document.getElementById('input-form').classList.add('hidden');
        }

        function selectExamType(type) {
            if (isPerformanceOnlySubject && (type === 'midterm' || type === 'final')) {
                return;
            }
            
            currentExamType = type;
            
            document.querySelectorAll('.btn-hover').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = document.getElementById(type + '-btn');
            selectedBtn.classList.add('selected');

            document.getElementById('absence-reason').classList.remove('hidden');
            document.getElementById('calculation-method').classList.add('hidden');
            document.getElementById('input-form').classList.add('hidden');
        }

        function selectAbsenceReason(reason) {
            currentAbsenceReason = reason;
            
            document.querySelectorAll('#absence-reason .btn-hover').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = document.getElementById(reason + '-btn');
            selectedBtn.classList.add('selected');

            showCalculationMethods(currentExamType);
        }

        function showCalculationMethods(type) {
            const methodDiv = document.getElementById('calculation-method');
            const optionsDiv = document.getElementById('method-options');
            
            if (currentAbsenceReason === 'unapproved') {
                methodDiv.classList.add('hidden');
                currentMethod = 'no-score';
                showInputForm(type, 'no-score');
                return;
            }
            
            methodDiv.classList.remove('hidden');
            optionsDiv.innerHTML = '';

            let methods = [];
            
            if (type === 'midterm') {
                methods = [
                    { id: 'final-score', label: 'ê¸°ë§ê³ ì‚¬ ì„±ì  ìˆìŒ', desc: 'ê¸°ë§ê³ ì‚¬ ì ìˆ˜ë¡œ ì¤‘ê°„ê³ ì‚¬ ì¸ì •ì  ê³„ì‚°' },
                    { id: 'performance-only', label: 'ìˆ˜í–‰í‰ê°€ ì„±ì  ìˆìŒ', desc: 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¡œ ì¤‘ê°„ê³ ì‚¬ ì¸ì •ì  ê³„ì‚°' },
                    { id: 'no-score', label: 'ì„±ì  ì—†ìŒ', desc: 'ì¤‘ê°„ê³ ì‚¬ ìµœí•˜ì -1ì  ì ìš©' }
                ];
            } else if (type === 'final') {
                methods = [
                    { id: 'midterm-score', label: 'ì¤‘ê°„ê³ ì‚¬ ì„±ì  ìˆìŒ', desc: 'ì¤‘ê°„ê³ ì‚¬ ì ìˆ˜ë¡œ ê¸°ë§ê³ ì‚¬ ì¸ì •ì  ê³„ì‚°' },
                    { id: 'performance-only', label: 'ìˆ˜í–‰í‰ê°€ ì„±ì  ìˆìŒ', desc: 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¡œ ê¸°ë§ê³ ì‚¬ ì¸ì •ì  ê³„ì‚°' },
                    { id: 'no-score', label: 'ì„±ì  ì—†ìŒ', desc: 'ê¸°ë§ê³ ì‚¬ ìµœí•˜ì -1ì  ì ìš©' }
                ];
            } else if (type === 'english-listening') {
                methods = [
                    { id: 'written-exam', label: 'ì§€í•„ê³ ì‚¬ ì„±ì  ìˆìŒ', desc: 'ì˜ì–´ ì§€í•„í‰ê°€ ì ìˆ˜ë¡œ ê³„ì‚°' },
                    { id: 'performance-only', label: 'ìˆ˜í–‰í‰ê°€ë§Œ ìˆìŒ', desc: 'ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¡œ ê³„ì‚°' },
                    { id: 'no-score', label: 'ì„±ì  ì—†ìŒ', desc: 'ì˜ì–´ë“£ê¸° ìµœí•˜ì -1ì  ì ìš©' }
                ];
            } else {
                if (isPerformanceOnlySubject) {
                    methods = [
                        { id: 'other-performance', label: 'ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ ìˆìŒ', desc: 'ë‹¤ë¥¸ ì˜ì—­ ìˆ˜í–‰í‰ê°€ë¡œ ê³„ì‚°' },
                        { id: 'no-score', label: 'ì„±ì  ì—†ìŒ', desc: 'ìˆ˜í–‰í‰ê°€ ìµœí•˜ì -1ì  ì ìš©' }
                    ];
                } else {
                    methods = [
                        { id: 'other-performance', label: 'ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ ìˆìŒ', desc: 'ë‹¤ë¥¸ ì˜ì—­ ìˆ˜í–‰í‰ê°€ë¡œ ê³„ì‚°' },
                        { id: 'written-exam', label: 'ì§€í•„í‰ê°€ ì ìˆ˜ ìˆìŒ', desc: 'ì¤‘ê°„/ê¸°ë§ê³ ì‚¬ ì ìˆ˜ë¡œ ê³„ì‚°' },
                        { id: 'no-score', label: 'ì„±ì  ì—†ìŒ', desc: 'ìˆ˜í–‰í‰ê°€ ìµœí•˜ì -1ì  ì ìš©' }
                    ];
                }
            }

            // ìš°ì„ ìˆœìœ„ ì•ˆë‚´ ì¶”ê°€
            const priorityNotice = document.createElement('div');
            priorityNotice.className = 'mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3';
            priorityNotice.innerHTML = `
                <p class="text-sm text-yellow-800">
                    <strong>ğŸ’¡ ìš°ì„ ìˆœìœ„:</strong> 1ë²ˆ â†’ 2ë²ˆ â†’ 3ë²ˆ ìˆœì„œë¡œ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                </p>
            `;
            optionsDiv.appendChild(priorityNotice);

            methods.forEach((method, index) => {
                const methodBtn = document.createElement('div');
                methodBtn.className = 'method-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-all duration-200';
                methodBtn.onclick = () => selectMethod(method.id);
                methodBtn.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-bold text-sm mr-3">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${method.label}</div>
                            <div class="text-sm text-gray-600">${method.desc}</div>
                        </div>
                    </div>
                `;
                optionsDiv.appendChild(methodBtn);
            });
        }

        function selectMethod(method) {
            currentMethod = method;
            
            document.querySelectorAll('.method-option').forEach(option => {
                option.classList.remove('border-blue-500', 'bg-blue-50');
                option.classList.add('border-gray-200');
            });
            
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');
            event.currentTarget.classList.remove('border-gray-200');

            showInputForm(currentExamType, method);
        }

        function showInputForm(examType, method) {
            const formDiv = document.getElementById('input-form');
            const fieldsDiv = document.getElementById('input-fields');
            
            formDiv.classList.remove('hidden');
            fieldsDiv.innerHTML = '';

            let fields = [];

            if (examType === 'english-listening') {
                if (method === 'written-exam') {
                    fields = [
                        { id: 'student-written-score', label: 'í•´ë‹¹ í•™ìƒì˜ ì˜ì–´ ì§€í•„í‰ê°€ ì ìˆ˜', placeholder: 'ì˜ˆ: 85', hasCalculator: true, calculatorType: 'student-written' },
                        { id: 'written-avg', label: 'ì „ì²´ í•™ìƒì˜ ì˜ì–´ ì§€í•„í‰ê°€ í‰ê· ', placeholder: 'ì˜ˆ: 78.2', hasCalculator: true, calculatorType: 'written-avg' },
                        { id: 'listening-avg', label: 'ì „ì²´ í•™ìƒì˜ ì˜ì–´ë“£ê¸°í‰ê°€ í‰ê·  ì ìˆ˜', placeholder: 'ì˜ˆ: 82.5' }
                    ];
                } else if (method === 'performance-only') {
                    fields = [
                        { id: 'student-perf-score', label: 'í•´ë‹¹ í•™ìƒì˜ ì˜ì–´ ìˆ˜í–‰í‰ê°€ í‰ê· ì ìˆ˜', placeholder: 'ì˜ˆ: 88', hasCalculator: true, calculatorType: 'student-performance' },
                        { id: 'listening-avg', label: 'ì „ì²´ í•™ìƒì˜ ì˜ì–´ë“£ê¸°í‰ê°€ í‰ê·  ì ìˆ˜', placeholder: 'ì˜ˆ: 82.5' },
                        { id: 'perf-excluding-listening-avg', label: 'ì˜ì–´ë“£ê¸° ì œì™¸í•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì˜ í‰ê· ì ìˆ˜', placeholder: 'ì˜ˆ: 85.3', hasCalculator: true, calculatorType: 'performance-avg' }
                    ];
                } else if (method === 'no-score') {
                    fields = [
                        { id: 'listening-min', label: 'ì˜ì–´ë“£ê¸° í‰ê°€ ìµœí•˜ì ', placeholder: 'ì˜ˆ: 40' }
                    ];
                }
            } else if (examType === 'midterm') {
                if (method === 'final-score') {
                    fields = [
                        { id: 'midterm-avg', label: 'ì¤‘ê°„ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 75.5' },
                        { id: 'final-score', label: 'ê¸°ë§ê³ ì‚¬ ì ìˆ˜', placeholder: 'ì˜ˆ: 85' },
                        { id: 'final-avg', label: 'ê¸°ë§ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 78.2' }
                    ];
                } else if (method === 'performance-only') {
                    fields = [
                        { id: 'midterm-avg', label: 'ì¤‘ê°„ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 75.5' },
                        { id: 'performance-score', label: 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜', placeholder: 'ì˜ˆ: 88', hasCalculator: true, calculatorType: 'student-performance' },
                        { id: 'performance-avg', label: 'ìˆ˜í–‰í‰ê°€ í‰ê· ', placeholder: 'ì˜ˆ: 82.3', hasCalculator: true, calculatorType: 'performance-avg' }
                    ];
                } else if (method === 'no-score') {
                    fields = [
                        { id: 'midterm-min', label: 'ì¤‘ê°„ê³ ì‚¬ ìµœí•˜ì ', placeholder: 'ì˜ˆ: 40' }
                    ];
                }
            } else if (examType === 'final') {
                if (method === 'midterm-score') {
                    fields = [
                        { id: 'final-avg', label: 'ê¸°ë§ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 78.2' },
                        { id: 'midterm-score', label: 'ì¤‘ê°„ê³ ì‚¬ ì ìˆ˜', placeholder: 'ì˜ˆ: 82' },
                        { id: 'midterm-avg', label: 'ì¤‘ê°„ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 75.5' }
                    ];
                } else if (method === 'performance-only') {
                    fields = [
                        { id: 'final-avg', label: 'ê¸°ë§ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 78.2' },
                        { id: 'performance-score', label: 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜', placeholder: 'ì˜ˆ: 88', hasCalculator: true, calculatorType: 'student-performance' },
                        { id: 'performance-avg', label: 'ìˆ˜í–‰í‰ê°€ í‰ê· ', placeholder: 'ì˜ˆ: 82.3', hasCalculator: true, calculatorType: 'performance-avg' }
                    ];
                } else if (method === 'no-score') {
                    fields = [
                        { id: 'final-min', label: 'ê¸°ë§ê³ ì‚¬ ìµœí•˜ì ', placeholder: 'ì˜ˆ: 40' }
                    ];
                }
            } else if (examType === 'performance') {
                if (method === 'other-performance') {
                    fields = [
                        { id: 'student-performance-areas', label: 'í•´ë‹¹ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë“¤', placeholder: 'í•™ìƒì´ ì‘ì‹œí•œ ì˜ì—­ë“¤ì˜ ì ìˆ˜', hasCalculator: true, calculatorType: 'student-performance-areas', description: 'ê²°ì‹œí•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì—ì„œ í•´ë‹¹ í•™ìƒì´ ë°›ì€ ì ìˆ˜ë“¤ (ìë™ í‰ê·  ê³„ì‚°)' },
                        { id: 'class-performance-areas', label: 'ì „ì²´ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ í‰ê· ë“¤', placeholder: 'ì „ì²´ í•™ìƒë“¤ì˜ í•´ë‹¹ ì˜ì—­ í‰ê· ì ìˆ˜', hasCalculator: true, calculatorType: 'class-performance-areas', description: 'ê²°ì‹œí•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì—ì„œ ì „ì²´ í•™ìƒë“¤ì˜ í‰ê· ì ìˆ˜ë“¤ (ìë™ í‰ê·  ê³„ì‚°)' },
                        { id: 'absent-performance-avg', label: 'ì „ì²´ í•™ìƒì˜ ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ í‰ê· ', placeholder: 'ì˜ˆ: 82.3', description: 'ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì—ì„œ ì „ì²´ í•™ìƒë“¤ì˜ í‰ê· ì ìˆ˜' },
                        { id: 'absent-performance-name', label: 'ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ëª…', placeholder: 'ì˜ˆ: í¬íŠ¸í´ë¦¬ì˜¤', type: 'text', description: 'í•™ìƒì´ ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì˜ ì´ë¦„' }
                    ];
                } else if (method === 'written-exam') {
                    fields = [
                        { id: 'midterm-score', label: 'í•´ë‹¹ í•™ìƒì˜ ì¤‘ê°„ê³ ì‚¬ ì ìˆ˜', placeholder: 'ì˜ˆ: 82 (ì—†ìœ¼ë©´ 0)', description: 'í•´ë‹¹ í•™ìƒì´ ì¤‘ê°„ê³ ì‚¬ì—ì„œ ë°›ì€ ì ìˆ˜ (ì‘ì‹œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ 0 ì…ë ¥)' },
                        { id: 'midterm-avg', label: 'ì „ì²´ í•™ìƒì˜ ì¤‘ê°„ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 75.5 (ì—†ìœ¼ë©´ 0)', description: 'ì „ì²´ í•™ìƒë“¤ì˜ ì¤‘ê°„ê³ ì‚¬ í‰ê· ì ìˆ˜ (ì‹¤ì‹œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ 0 ì…ë ¥)' },
                        { id: 'final-score', label: 'í•´ë‹¹ í•™ìƒì˜ ê¸°ë§ê³ ì‚¬ ì ìˆ˜', placeholder: 'ì˜ˆ: 85 (ì—†ìœ¼ë©´ 0)', description: 'í•´ë‹¹ í•™ìƒì´ ê¸°ë§ê³ ì‚¬ì—ì„œ ë°›ì€ ì ìˆ˜ (ì‘ì‹œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ 0 ì…ë ¥)' },
                        { id: 'final-avg', label: 'ì „ì²´ í•™ìƒì˜ ê¸°ë§ê³ ì‚¬ í‰ê· ', placeholder: 'ì˜ˆ: 78.2 (ì—†ìœ¼ë©´ 0)', description: 'ì „ì²´ í•™ìƒë“¤ì˜ ê¸°ë§ê³ ì‚¬ í‰ê· ì ìˆ˜ (ì‹¤ì‹œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ 0 ì…ë ¥)' },
                        { id: 'absent-performance-avg', label: 'ì „ì²´ í•™ìƒì˜ ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ í‰ê· ', placeholder: 'ì˜ˆ: 82.3', description: 'ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì—ì„œ ì „ì²´ í•™ìƒë“¤ì˜ í‰ê· ì ìˆ˜' },
                        { id: 'absent-performance-name', label: 'ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ëª…', placeholder: 'ì˜ˆ: í¬íŠ¸í´ë¦¬ì˜¤', type: 'text', description: 'í•™ìƒì´ ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ì˜ ì´ë¦„' }
                    ];
                } else if (method === 'no-score') {
                    fields = [
                        { id: 'performance-min', label: 'ìˆ˜í–‰í‰ê°€ ìµœí•˜ì ', placeholder: 'ì˜ˆ: 40' },
                        { id: 'absent-performance-name', label: 'ê²°ì‹œí•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ëª…', placeholder: 'ì˜ˆ: í¬íŠ¸í´ë¦¬ì˜¤', type: 'text' }
                    ];
                }
            }

            fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                const inputType = field.type === 'text' ? 'text' : 'number';
                const stepAttr = field.type === 'text' ? '' : 'step="0.1"';
                
                let calculatorButton = '';
                if (field.hasCalculator) {
                    calculatorButton = `
                        <button type="button" onclick="openCalculator('${field.id}', '${field.calculatorType}')" 
                                class="ml-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200">
                            ê³„ì‚°ê¸°
                        </button>
                    `;
                }
                
                let descriptionHtml = '';
                if (field.description) {
                    descriptionHtml = `<p class="text-xs text-gray-500 mt-1">${field.description}</p>`;
                }
                
                fieldDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700 mb-2">${field.label}</label>
                    <div class="flex items-center">
                        <input type="${inputType}" ${stepAttr} id="${field.id}" placeholder="${field.placeholder}" 
                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        ${calculatorButton}
                    </div>
                    ${descriptionHtml}
                `;
                fieldsDiv.appendChild(fieldDiv);
                
                // ì €ì¥ëœ í‰ê· ê°’ ìë™ ì…ë ¥
                const input = fieldDiv.querySelector('input');
                if (field.id === 'midterm-avg' && savedAverages.midterm) {
                    input.value = savedAverages.midterm;
                } else if (field.id === 'final-avg' && savedAverages.final) {
                    input.value = savedAverages.final;
                } else if (field.id === 'listening-avg' && savedAverages.englishListening) {
                    input.value = savedAverages.englishListening;
                } else if (field.id === 'written-avg' && savedAverages.midterm && savedAverages.final) {
                    // ì˜ì–´ë“£ê¸° ì§€í•„í‰ê°€ í‰ê·  ìë™ ê³„ì‚°
                    const writtenAvg = (savedAverages.midterm + savedAverages.final) / 2;
                    input.value = writtenAvg.toFixed(2);
                }
                
                // í‰ê· ê°’ ë³€ê²½ ì‹œ ìë™ ì €ì¥
                if (field.id === 'midterm-avg') {
                    input.addEventListener('change', function() {
                        if (this.value) saveAverage('midterm', this.value);
                    });
                } else if (field.id === 'final-avg') {
                    input.addEventListener('change', function() {
                        if (this.value) saveAverage('final', this.value);
                    });
                } else if (field.id === 'listening-avg') {
                    input.addEventListener('change', function() {
                        if (this.value) saveAverage('englishListening', this.value);
                    });
                } else if (field.id === 'absent-performance-avg') {
                    input.addEventListener('change', function() {
                        const subject = document.getElementById('student-subject').value;
                        const areaName = document.getElementById('absent-performance-name')?.value;
                        if (subject && areaName && this.value) {
                            savePerformanceAverage(subject, areaName, this.value);
                        }
                    });
                } else if (field.id === 'absent-performance-name') {
                    input.addEventListener('change', function() {
                        const subject = document.getElementById('student-subject').value;
                        const avgValue = document.getElementById('absent-performance-avg')?.value;
                        if (subject && this.value && avgValue) {
                            savePerformanceAverage(subject, this.value, avgValue);
                        }
                        // ê¸°ì¡´ ì €ì¥ëœ ê°’ì´ ìˆìœ¼ë©´ ìë™ ì…ë ¥
                        if (subject && this.value && savedAverages.performance[subject] && savedAverages.performance[subject][this.value]) {
                            document.getElementById('absent-performance-avg').value = savedAverages.performance[subject][this.value];
                        }
                    });
                }
            });
        }

        function calculateScore() {
            let result = 0;
            let reasonText = '';
            
            // ê²°ì‹œ ì‚¬ìœ ë³„ ì¸ì • ë¹„ìœ¨
            let recognitionRate = 1.0;
            if (currentAbsenceReason === 'sick') {
                recognitionRate = 0.8;
                reasonText = 'ë³‘ê²°';
            } else if (currentAbsenceReason === 'approved') {
                recognitionRate = 1.0;
                reasonText = 'ì¸ì •ê²°';
            } else if (currentAbsenceReason === 'unapproved') {
                reasonText = 'ë¯¸ì¸ì •ê²°';
            }
            
            try {
                // ì„±ì  ì—†ìŒ ì²˜ë¦¬ (ëª¨ë“  ê²°ì‹œ ì‚¬ìœ ì— ëŒ€í•´)
                if (currentMethod === 'no-score') {
                    let minScore = 0;
                    if (currentExamType === 'midterm') {
                        minScore = parseFloat(document.getElementById('midterm-min')?.value);
                    } else if (currentExamType === 'final') {
                        minScore = parseFloat(document.getElementById('final-min')?.value);
                    } else if (currentExamType === 'performance') {
                        minScore = parseFloat(document.getElementById('performance-min')?.value);
                    } else if (currentExamType === 'english-listening') {
                        minScore = parseFloat(document.getElementById('listening-min')?.value);
                    }
                    
                    if (isNaN(minScore) || minScore <= 0) {
                        alert('ìµœí•˜ì ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    // ì„±ì  ì—†ìŒì˜ ê²½ìš° ê¸°ì¤€ì ê³¼ ì¸ì •ì ì„ ë³„ë„ë¡œ ì²˜ë¦¬
                    const baseScore = minScore;
                    const finalScore = minScore - 1;
                    addResultToTable(baseScore, finalScore, reasonText);
                    resetForm();
                    return;
                } else {
                    // ì¼ë°˜ì ì¸ ê³„ì‚°
                    if (currentExamType === 'english-listening') {
                        if (currentMethod === 'written-exam') {
                            const studentWrittenScore = parseFloat(document.getElementById('student-written-score').value);
                            const writtenAvg = parseFloat(document.getElementById('written-avg').value);
                            const listeningAvg = parseFloat(document.getElementById('listening-avg').value);
                            
                            const calculatedScore = (studentWrittenScore / writtenAvg) * listeningAvg;
                            result = calculatedScore * recognitionRate;
                        } else if (currentMethod === 'performance-only') {
                            const studentPerfScore = parseFloat(document.getElementById('student-perf-score').value);
                            const listeningAvg = parseFloat(document.getElementById('listening-avg').value);
                            const perfExcludingListeningAvg = parseFloat(document.getElementById('perf-excluding-listening-avg').value);
                            
                            const calculatedScore = studentPerfScore * (listeningAvg / perfExcludingListeningAvg);
                            result = calculatedScore * recognitionRate;
                        }
                    } else if (currentExamType === 'midterm') {
                        if (currentMethod === 'final-score') {
                            const midtermAvg = parseFloat(document.getElementById('midterm-avg').value);
                            const finalScore = parseFloat(document.getElementById('final-score').value);
                            const finalAvg = parseFloat(document.getElementById('final-avg').value);
                            
                            const calculatedScore = (finalScore / finalAvg) * midtermAvg;
                            result = calculatedScore * recognitionRate;
                        } else if (currentMethod === 'performance-only') {
                            const midtermAvg = parseFloat(document.getElementById('midterm-avg').value);
                            const performanceScore = parseFloat(document.getElementById('performance-score').value);
                            const performanceAvg = parseFloat(document.getElementById('performance-avg').value);
                            
                            const calculatedScore = (performanceScore / performanceAvg) * midtermAvg;
                            result = calculatedScore * recognitionRate;
                        }
                    } else if (currentExamType === 'final') {
                        if (currentMethod === 'midterm-score') {
                            const finalAvg = parseFloat(document.getElementById('final-avg').value);
                            const midtermScore = parseFloat(document.getElementById('midterm-score').value);
                            const midtermAvg = parseFloat(document.getElementById('midterm-avg').value);
                            
                            const calculatedScore = (midtermScore / midtermAvg) * finalAvg;
                            result = calculatedScore * recognitionRate;
                        } else if (currentMethod === 'performance-only') {
                            const finalAvg = parseFloat(document.getElementById('final-avg').value);
                            const performanceScore = parseFloat(document.getElementById('performance-score').value);
                            const performanceAvg = parseFloat(document.getElementById('performance-avg').value);
                            
                            const calculatedScore = (performanceScore / performanceAvg) * finalAvg;
                            result = calculatedScore * recognitionRate;
                        }
                    } else if (currentExamType === 'performance') {
                        if (currentMethod === 'other-performance') {
                            // 1) ë‹¤ë¥¸ ì˜ì—­ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°
                            // ê¸°ì¤€ì ìˆ˜ = í•´ë‹¹ í•™ìƒì˜ B,C í‰ê· ì ìˆ˜ * (ì „ì²´ í•™ìƒì˜ A í‰ê· ì ìˆ˜ / ì „ì²´ í•™ìƒì˜ B,C í‰ê· ì ìˆ˜)
                            const studentOtherPerformanceAvg = parseFloat(document.getElementById('student-performance-areas').value);
                            const classOtherPerformanceAvg = parseFloat(document.getElementById('class-performance-areas').value);
                            const absentPerformanceAvg = parseFloat(document.getElementById('absent-performance-avg').value);
                            
                            const calculatedScore = studentOtherPerformanceAvg * (absentPerformanceAvg / classOtherPerformanceAvg);
                            result = calculatedScore * recognitionRate;
                        } else if (currentMethod === 'written-exam') {
                            // 2) ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ì—†ëŠ” ê²½ìš°
                            // ê¸°ì¤€ì ìˆ˜ = í•´ë‹¹ í•™ìƒì˜ ì§€í•„í‰ê°€ ì ìˆ˜ * (ì „ì²´ í•™ìƒì˜ ìˆ˜í–‰í‰ê°€ í‰ê·  / ì „ì²´ í•™ìƒì˜ ì§€í•„í‰ê°€ í‰ê· )
                            const midtermScore = parseFloat(document.getElementById('midterm-score').value) || 0;
                            const midtermAvg = parseFloat(document.getElementById('midterm-avg').value) || 0;
                            const finalScore = parseFloat(document.getElementById('final-score').value) || 0;
                            const finalAvg = parseFloat(document.getElementById('final-avg').value) || 0;
                            const absentPerformanceAvg = parseFloat(document.getElementById('absent-performance-avg').value);
                            
                            // í•™ìƒì˜ ì§€í•„í‰ê°€ ì ìˆ˜ ê³„ì‚° (ì¤‘ê°„+ê¸°ë§ í‰ê·  ë˜ëŠ” ìˆëŠ” ê²ƒë§Œ)
                            let studentWrittenScore = 0;
                            let classWrittenAvg = 0;
                            
                            if (midtermScore > 0 && finalScore > 0) {
                                studentWrittenScore = (midtermScore + finalScore) / 2;
                                classWrittenAvg = (midtermAvg + finalAvg) / 2;
                            } else if (midtermScore > 0) {
                                studentWrittenScore = midtermScore;
                                classWrittenAvg = midtermAvg;
                            } else if (finalScore > 0) {
                                studentWrittenScore = finalScore;
                                classWrittenAvg = finalAvg;
                            }
                            
                            const calculatedScore = studentWrittenScore * (absentPerformanceAvg / classWrittenAvg);
                            result = calculatedScore * recognitionRate;
                        }
                    }
                }

                result = Math.round(result * 100) / 100;
                
                // ê¸°ì¤€ì ê³¼ ìµœì¢… ì¸ì •ì  ê³„ì‚°
                let baseScore, finalScore;
                
                if (currentAbsenceReason === 'sick') {
                    // ë³‘ê²°ì¸ ê²½ìš°: ê¸°ì¤€ì ì€ 0.8 ê³±í•˜ê¸° ì „ ê°’, ì¸ì •ì ì€ 0.8 ê³±í•œ ê°’
                    baseScore = result / recognitionRate; // 0.8ë¡œ ë‚˜ëˆ„ì–´ì„œ ì›ë˜ ê°’ ë³µì›
                    finalScore = result > 100 ? 100 : result;
                } else {
                    // ì¸ì •ê²°ì¸ ê²½ìš°: ê¸°ì¤€ì ê³¼ ì¸ì •ì ì´ ë™ì¼
                    baseScore = result;
                    finalScore = result > 100 ? 100 : result;
                }
                
                addResultToTable(baseScore, finalScore, reasonText);
                resetForm();
                
            } catch (error) {
                alert('ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
            }
        }

        function addResultToTable(baseScore, finalScore, reasonText) {
            const studentGrade = document.getElementById('student-grade').value || '-';
            const studentClass = document.getElementById('student-class').value || '-';
            const studentNumber = document.getElementById('student-number').value || '-';
            const studentName = document.getElementById('student-name').value || '-';
            const studentSubject = document.getElementById('student-subject').value || '-';
            
            const examTypeText = currentExamType === 'midterm' ? 'ì§€í•„ê³ ì‚¬' : 
                               currentExamType === 'final' ? 'ì§€í•„ê³ ì‚¬' : 
                               currentExamType === 'english-listening' ? 'ìˆ˜í–‰í‰ê°€' : 'ìˆ˜í–‰í‰ê°€';
            
            let detailName = '';
            if (currentExamType === 'midterm') {
                detailName = 'ì¤‘ê°„ê³ ì‚¬';
            } else if (currentExamType === 'final') {
                detailName = 'ê¸°ë§ê³ ì‚¬';
            } else if (currentExamType === 'english-listening') {
                detailName = 'ì˜ì–´ë“£ê¸°';
            } else if (currentExamType === 'performance') {
                detailName = document.getElementById('absent-performance-name')?.value || 'ìˆ˜í–‰í‰ê°€';
            }
            
            resultCounter++;
            
            // ì¸ì •ë¹„ìœ¨ í…ìŠ¤íŠ¸ ìƒì„±
            let recognitionRateText = '';
            if (currentMethod === 'no-score') {
                recognitionRateText = 'ìµœí•˜ì ì˜ ì°¨í•˜ì ';
            } else if (currentAbsenceReason === 'sick') {
                recognitionRateText = '80%';
            } else if (currentAbsenceReason === 'approved') {
                recognitionRateText = '100%';
            } else if (currentAbsenceReason === 'unapproved') {
                recognitionRateText = 'ìµœí•˜ì ì˜ ì°¨í•˜ì ';
            }
            
            // ì‚°ì¶œê¸°ì¤€ í…ìŠ¤íŠ¸ ìƒì„±
            let calculationBasisText = '';
            if (currentMethod === 'no-score') {
                if (currentAbsenceReason === 'unapproved') {
                    if (currentExamType === 'midterm' || currentExamType === 'final') {
                        calculationBasisText = 'ë¯¸ì‘ì‹œ ì§€í•„ê³ ì‚¬ ìµœí•˜ì ';
                    } else if (currentExamType === 'performance' || currentExamType === 'english-listening') {
                        calculationBasisText = 'ë¯¸ì‘ì‹œ ìˆ˜í–‰í‰ê°€ ìµœí•˜ì ';
                    }
                } else {
                    calculationBasisText = 'ì „ ì˜ì—­ ë¯¸ì‘ì‹œ';
                }
            } else if (currentExamType === 'midterm') {
                if (currentMethod === 'final-score') {
                    calculationBasisText = 'ì§€í•„ê³ ì‚¬ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                } else if (currentMethod === 'performance-only') {
                    calculationBasisText = 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                }
            } else if (currentExamType === 'final') {
                if (currentMethod === 'midterm-score') {
                    calculationBasisText = 'ì§€í•„ê³ ì‚¬ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                } else if (currentMethod === 'performance-only') {
                    calculationBasisText = 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                }
            } else if (currentExamType === 'performance') {
                if (currentMethod === 'other-performance') {
                    calculationBasisText = 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                } else if (currentMethod === 'written-exam') {
                    calculationBasisText = 'ì§€í•„ê³ ì‚¬ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                }
            } else if (currentExamType === 'english-listening') {
                if (currentMethod === 'written-exam') {
                    calculationBasisText = 'ì§€í•„ê³ ì‚¬ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                } else if (currentMethod === 'performance-only') {
                    calculationBasisText = 'ìˆ˜í–‰í‰ê°€ ì ìˆ˜ê°€ ìˆëŠ” ê²½ìš°';
                }
            }
            
            // ë¹„ê³  í…ìŠ¤íŠ¸ ìƒì„±
            let remarksText = '';
            if (baseScore > 100) {
                remarksText = '100ì  ìƒí•œ ì ìš©';
            }
            
            const resultData = {
                id: resultCounter,
                grade: studentGrade,
                class: studentClass,
                number: studentNumber,
                name: studentName,
                subject: studentSubject,
                examType: examTypeText,
                detailName: detailName,
                absenceReason: reasonText,
                recognitionRate: recognitionRateText,
                calculationBasis: calculationBasisText,
                baseScore: baseScore.toFixed(2),
                finalScore: finalScore.toFixed(2),
                remarks: remarksText
            };
            resultsData.push(resultData);
            
            const tbody = document.getElementById('results-tbody');
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.id = `result-row-${resultCounter}`;
            
            const reasonClass = currentAbsenceReason === 'sick' ? 'bg-red-100 text-red-800' :
                              currentAbsenceReason === 'approved' ? 'bg-blue-100 text-blue-800' :
                              'bg-gray-100 text-gray-800';
            
            // ê¸°ì¤€ì ê³¼ ì¸ì •ì  í‘œì‹œ ìŠ¤íƒ€ì¼ ê²°ì •
            const baseScoreDisplay = baseScore > 100 ? 
                `<span class="text-orange-600 font-bold">${baseScore.toFixed(2)}ì </span>` : 
                `<span class="text-blue-600">${baseScore.toFixed(2)}ì </span>`;
            
            const finalScoreDisplay = baseScore > 100 ? 
                `<span class="text-green-800 font-bold">100.00ì </span>` : 
                `<span class="text-green-800 font-bold">${finalScore.toFixed(2)}ì </span>`;
            
            // ì¸ì •ë¹„ìœ¨ í‘œì‹œ ìŠ¤íƒ€ì¼
            const rateClass = currentAbsenceReason === 'sick' ? 'text-orange-600' :
                             currentAbsenceReason === 'approved' ? 'text-blue-600' :
                             'text-gray-600';
            
            row.innerHTML = `
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${resultCounter}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${studentGrade}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${studentClass}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${studentNumber}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${studentName}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${studentSubject}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${examTypeText}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${detailName}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">
                    <span class="px-2 py-1 rounded text-xs font-medium ${reasonClass}">
                        ${reasonText}
                    </span>
                </td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">
                    <span class="font-medium ${rateClass}">${recognitionRateText}</span>
                </td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm text-gray-700">${calculationBasisText}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${baseScoreDisplay}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">${finalScoreDisplay}</td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">
                    <span class="text-xs ${remarksText ? 'text-purple-600 font-medium' : 'text-gray-400'}">${remarksText || '-'}</span>
                </td>
                <td class="border border-gray-300 px-3 py-2 text-center text-sm">
                    <button type="button" onclick="deleteResult(${resultCounter})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs transition-all duration-200">
                        ì‚­ì œ
                    </button>
                </td>
            `;
            
            tbody.appendChild(row);
            
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('hidden');
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function deleteResult(id) {
            resultsData = resultsData.filter(data => data.id !== id);
            
            const row = document.getElementById(`result-row-${id}`);
            if (row) {
                row.remove();
            }
            
            if (resultsData.length === 0) {
                document.getElementById('result').classList.add('hidden');
            }
        }

        function clearResults() {
            if (resultsData.length === 0) {
                alert('ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ëª¨ë“  ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                resultsData = [];
                resultCounter = 0;
                document.getElementById('results-tbody').innerHTML = '';
                document.getElementById('result').classList.add('hidden');
                alert('ëª¨ë“  ê²°ê³¼ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function copyResults() {
            if (resultsData.length === 0) {
                alert('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const headers = ['ë²ˆí˜¸', 'í•™ë…„', 'ë°˜', 'í•™ë²ˆ', 'ì´ë¦„', 'ê³¼ëª©', 'ê²°ì‹œì‹œí—˜', 'ì„¸ë¶€ëª…', 'ê²°ì‹œì‚¬ìœ ', 'ì¸ì •ë¹„ìœ¨', 'ì‚°ì¶œê¸°ì¤€', 'ê¸°ì¤€ì ', 'ì¸ì •ì ', 'ë¹„ê³ '];
            let textContent = headers.join('\t') + '\n';
            
            resultsData.forEach(data => {
                const row = [
                    data.id,
                    data.grade,
                    data.class,
                    data.number,
                    data.name,
                    data.subject,
                    data.examType,
                    data.detailName,
                    data.absenceReason,
                    data.recognitionRate,
                    data.calculationBasis,
                    data.baseScore,
                    data.finalScore,
                    data.remarks
                ].join('\t');
                textContent += row + '\n';
            });
            
            navigator.clipboard.writeText(textContent).then(() => {
                alert('ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nExcelì— ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•˜ì„¸ìš”.');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nExcelì— ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•˜ì„¸ìš”.');
            });
        }
function downloadXLSX() {
    if (resultsData.length === 0) {
        alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }

    const headers = ['ë²ˆí˜¸','í•™ë…„','ë°˜','í•™ë²ˆ','ì´ë¦„','ê³¼ëª©','ê²°ì‹œì‹œí—˜','ì„¸ë¶€ëª…','ê²°ì‹œì‚¬ìœ ','ì¸ì •ë¹„ìœ¨','ì‚°ì¶œê¸°ì¤€','ê¸°ì¤€ì ','ì¸ì •ì ','ë¹„ê³ '];
    const rows = resultsData.map(data => [
        data.id,
        data.grade,
        data.class,
        data.number,
        data.name,
        data.subject,
        data.examType,
        data.detailName,
        data.absenceReason,
        data.recognitionRate,
        data.calculationBasis,
        Number(data.baseScore),
        Number(data.finalScore),
        data.remarks
    ]);

    const worksheet = XLSX.utils.aoa_to_sheet([headers, ...rows]);
    worksheet['!cols'] = headers.map(h => ({ wch: Math.max(10, h.length + 2) }));

    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "ê²°ê³¼");

    XLSX.writeFile(workbook, "ê²°ì‹œì_ì¸ì •ì .xlsx");
}
        function resetForm() {
            currentExamType = '';
            currentMethod = '';
            currentAbsenceReason = '';
            
            document.querySelectorAll('.btn-hover, .method-option').forEach(btn => {
                btn.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
            });
            
            document.getElementById('absence-reason').classList.add('hidden');
            document.getElementById('calculation-method').classList.add('hidden');
            document.getElementById('input-form').classList.add('hidden');
            document.getElementById('input-fields').innerHTML = '';
        }

        function openCalculator(targetId, calculatorType) {
            currentCalculatorTarget = targetId;
            currentCalculatorType = calculatorType;
            calculatorScores = [];
            
            const modal = document.getElementById('calculator-modal');
            const title = document.getElementById('calculator-title');
            const content = document.getElementById('calculator-content');
            
            if (calculatorType === 'student-written') {
                title.textContent = 'í•™ìƒ ì§€í•„í‰ê°€ ì ìˆ˜ ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">í•´ë‹¹ í•™ìƒì˜ ì¤‘ê°„ê³ ì‚¬ì™€ ê¸°ë§ê³ ì‚¬ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì—¬ ì§€í•„í‰ê°€ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì¤‘ê°„ê³ ì‚¬ ì ìˆ˜ (ì—†ìœ¼ë©´ ë¹„ì›Œë‘ì„¸ìš”)</label>
                            <input type="number" step="0.1" id="calc-student-midterm" placeholder="ì˜ˆ: 85" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê¸°ë§ê³ ì‚¬ ì ìˆ˜ (ì—†ìœ¼ë©´ ë¹„ì›Œë‘ì„¸ìš”)</label>
                            <input type="number" step="0.1" id="calc-student-final" placeholder="ì˜ˆ: 88" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="student-written-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                // ì‹¤ì‹œê°„ ê³„ì‚°
                const midtermInput = document.getElementById('calc-student-midterm');
                const finalInput = document.getElementById('calc-student-final');
                const resultSpan = document.getElementById('student-written-result');
                
                function updateStudentWritten() {
                    const midterm = parseFloat(midtermInput.value) || 0;
                    const final = parseFloat(finalInput.value) || 0;
                    
                    if (midterm > 0 && final > 0) {
                        const avg = (midterm + final) / 2;
                        resultSpan.textContent = avg.toFixed(2);
                    } else if (midterm > 0) {
                        resultSpan.textContent = midterm.toFixed(2);
                    } else if (final > 0) {
                        resultSpan.textContent = final.toFixed(2);
                    } else {
                        resultSpan.textContent = '-';
                    }
                }
                
                midtermInput.addEventListener('input', updateStudentWritten);
                finalInput.addEventListener('input', updateStudentWritten);
                
            } else if (calculatorType === 'written-avg') {
                title.textContent = 'ì˜ì–´ ì§€í•„í‰ê°€ í‰ê·  ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">ì¤‘ê°„ê³ ì‚¬ì™€ ê¸°ë§ê³ ì‚¬ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì—¬ ì§€í•„í‰ê°€ í‰ê· ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì¤‘ê°„ê³ ì‚¬ í‰ê· </label>
                            <input type="number" step="0.1" id="calc-midterm-avg" placeholder="ì˜ˆ: 75.5" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê¸°ë§ê³ ì‚¬ í‰ê· </label>
                            <input type="number" step="0.1" id="calc-final-avg" placeholder="ì˜ˆ: 78.2" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="written-avg-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                // ì‹¤ì‹œê°„ ê³„ì‚°
                const midtermInput = document.getElementById('calc-midterm-avg');
                const finalInput = document.getElementById('calc-final-avg');
                const resultSpan = document.getElementById('written-avg-result');
                
                function updateWrittenAvg() {
                    const midterm = parseFloat(midtermInput.value) || 0;
                    const final = parseFloat(finalInput.value) || 0;
                    if (midterm > 0 && final > 0) {
                        const avg = (midterm + final) / 2;
                        resultSpan.textContent = avg.toFixed(2);
                    } else {
                        resultSpan.textContent = '-';
                    }
                }
                
                midtermInput.addEventListener('input', updateWrittenAvg);
                finalInput.addEventListener('input', updateWrittenAvg);
                
            } else if (calculatorType === 'student-performance') {
                title.textContent = 'í•™ìƒ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">í•´ë‹¹ í•™ìƒì˜ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                        <div id="student-performance-scores-container">
                            <div class="student-performance-score-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë§í•˜ê¸°)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <button type="button" onclick="removeStudentPerformanceScore(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addStudentPerformanceScore()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="student-performance-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updateStudentPerformanceAvg();
                
            } else if (calculatorType === 'performance-avg') {
                title.textContent = 'ìˆ˜í–‰í‰ê°€ í‰ê·  ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">ì˜ì–´ë“£ê¸°ë¥¼ ì œì™¸í•œ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë“¤ì˜ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                        <div id="performance-scores-container">
                            <div class="performance-score-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë§í•˜ê¸°)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <button type="button" onclick="removePerformanceScore(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addPerformanceScore()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="performance-avg-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updatePerformanceAvg();
                
            } else if (calculatorType === 'other-performance-scores') {
                title.textContent = 'í•´ë‹¹ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">í•´ë‹¹ í•™ìƒì´ ê²°ì‹œí•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                        <div id="other-performance-scores-container">
                            <div class="other-performance-score-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë°œí‘œ)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                                       oninput="updateOtherPerformanceScores()">
                                <button type="button" onclick="removeOtherPerformanceScore(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addOtherPerformanceScore()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="other-performance-scores-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updateOtherPerformanceScores();
                
            } else if (calculatorType === 'student-performance-areas') {
                title.textContent = 'í•´ë‹¹ í•™ìƒì˜ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ ì ìˆ˜ ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">í•´ë‹¹ í•™ìƒì´ ê²°ì‹œí•˜ì§€ ì•Šì€ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ìµœëŒ€ 4ê°œ ì˜ì—­)</p>
                        <div id="student-areas-container">
                            <div class="student-area-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë§í•˜ê¸°)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                                       oninput="updateStudentAreas()">
                                <button type="button" onclick="removeStudentArea(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addStudentArea()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€ (ìµœëŒ€ 4ê°œ)
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>í‰ê·  ì ìˆ˜:</strong> <span id="student-areas-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updateStudentAreas();
                
            } else if (calculatorType === 'class-performance-areas') {
                title.textContent = 'ì „ì²´ í•™ìƒì˜ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ í‰ê·  ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">ì „ì²´ í•™ìƒë“¤ì´ ê²°ì‹œí•˜ì§€ ì•Šì€ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë³„ í‰ê·  ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ìµœëŒ€ 4ê°œ ì˜ì—­)</p>
                        <div id="class-areas-container">
                            <div class="class-area-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë§í•˜ê¸°)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                                       oninput="updateClassAreas()">
                                <button type="button" onclick="removeClassArea(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addClassArea()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€ (ìµœëŒ€ 4ê°œ)
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>í‰ê·  ì ìˆ˜:</strong> <span id="class-areas-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updateClassAreas();
                
            } else if (calculatorType === 'other-performance-avg') {
                title.textContent = 'ì „ì²´ í•™ìƒì˜ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ í‰ê·  ê³„ì‚°ê¸°';
                content.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">ì „ì²´ í•™ìƒë“¤ì´ ê²°ì‹œí•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ìˆ˜í–‰í‰ê°€ ì˜ì—­ë“¤ì˜ í‰ê·  ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                        <div id="other-performance-avg-container">
                            <div class="other-performance-avg-item flex items-center space-x-2 mb-2">
                                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ë°œí‘œ)" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                                       oninput="updateOtherPerformanceAvg()">
                                <button type="button" onclick="removeOtherPerformanceAvg(this)" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        <button type="button" onclick="addOtherPerformanceAvg()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm">
                            + ì˜ì—­ ì¶”ê°€
                        </button>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>ê³„ì‚° ê²°ê³¼:</strong> <span id="other-performance-avg-result">-</span>ì 
                            </div>
                        </div>
                    </div>
                `;
                
                updateOtherPerformanceAvg();
            }
            
            modal.classList.remove('hidden');
        }

        function addPerformanceScore() {
            const container = document.getElementById('performance-scores-container');
            const newItem = document.createElement('div');
            newItem.className = 'performance-score-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updatePerformanceAvg()">
                <button type="button" onclick="removePerformanceScore(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
            
            // ê¸°ì¡´ ì…ë ¥ í•„ë“œì—ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const scoreInputs = newItem.querySelectorAll('input[type="number"]');
            scoreInputs.forEach(input => {
                input.addEventListener('input', updatePerformanceAvg);
            });
        }

        function removePerformanceScore(button) {
            const container = document.getElementById('performance-scores-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updatePerformanceAvg();
            }
        }

        function updatePerformanceAvg() {
            const container = document.getElementById('performance-scores-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('performance-avg-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        function closeCalculator() {
            document.getElementById('calculator-modal').classList.add('hidden');
            currentCalculatorTarget = '';
            currentCalculatorType = '';
            calculatorScores = [];
        }

        function addStudentPerformanceScore() {
            const container = document.getElementById('student-performance-scores-container');
            const newItem = document.createElement('div');
            newItem.className = 'student-performance-score-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updateStudentPerformanceAvg()">
                <button type="button" onclick="removeStudentPerformanceScore(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
            
            // ê¸°ì¡´ ì…ë ¥ í•„ë“œì—ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const scoreInputs = newItem.querySelectorAll('input[type="number"]');
            scoreInputs.forEach(input => {
                input.addEventListener('input', updateStudentPerformanceAvg);
            });
        }

        function removeStudentPerformanceScore(button) {
            const container = document.getElementById('student-performance-scores-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateStudentPerformanceAvg();
            }
        }

        function updateStudentPerformanceAvg() {
            const container = document.getElementById('student-performance-scores-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('student-performance-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        function addOtherPerformanceScore() {
            const container = document.getElementById('other-performance-scores-container');
            const newItem = document.createElement('div');
            newItem.className = 'other-performance-score-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updateOtherPerformanceScores()">
                <button type="button" onclick="removeOtherPerformanceScore(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
        }

        function removeOtherPerformanceScore(button) {
            const container = document.getElementById('other-performance-scores-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateOtherPerformanceScores();
            }
        }

        function updateOtherPerformanceScores() {
            const container = document.getElementById('other-performance-scores-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('other-performance-scores-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        function addOtherPerformanceAvg() {
            const container = document.getElementById('other-performance-avg-container');
            const newItem = document.createElement('div');
            newItem.className = 'other-performance-avg-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updateOtherPerformanceAvg()">
                <button type="button" onclick="removeOtherPerformanceAvg(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
        }

        function removeOtherPerformanceAvg(button) {
            const container = document.getElementById('other-performance-avg-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateOtherPerformanceAvg();
            }
        }

        function updateOtherPerformanceAvg() {
            const container = document.getElementById('other-performance-avg-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('other-performance-avg-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        function applyCalculation() {
            let result = 0;
            
            if (currentCalculatorType === 'student-written') {
                const midterm = parseFloat(document.getElementById('calc-student-midterm').value) || 0;
                const final = parseFloat(document.getElementById('calc-student-final').value) || 0;
                
                if (midterm > 0 && final > 0) {
                    result = (midterm + final) / 2;
                } else if (midterm > 0) {
                    result = midterm;
                } else if (final > 0) {
                    result = final;
                } else {
                    alert('ì¤‘ê°„ê³ ì‚¬ ë˜ëŠ” ê¸°ë§ê³ ì‚¬ ì ìˆ˜ ì¤‘ ìµœì†Œ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'written-avg') {
                const midterm = parseFloat(document.getElementById('calc-midterm-avg').value) || 0;
                const final = parseFloat(document.getElementById('calc-final-avg').value) || 0;
                
                if (midterm > 0 && final > 0) {
                    result = (midterm + final) / 2;
                } else {
                    alert('ì¤‘ê°„ê³ ì‚¬ì™€ ê¸°ë§ê³ ì‚¬ í‰ê· ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'student-performance') {
                const container = document.getElementById('student-performance-scores-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'performance-avg') {
                const container = document.getElementById('performance-scores-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'student-performance-areas') {
                const container = document.getElementById('student-areas-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'class-performance-areas') {
                const container = document.getElementById('class-areas-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'other-performance-scores') {
                const container = document.getElementById('other-performance-scores-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else if (currentCalculatorType === 'other-performance-avg') {
                const container = document.getElementById('other-performance-avg-container');
                const scoreInputs = container.querySelectorAll('input[type="number"]');
                
                let total = 0;
                let count = 0;
                
                scoreInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (value > 0) {
                        total += value;
                        count++;
                    }
                });
                
                if (count > 0) {
                    result = total / count;
                } else {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜í–‰í‰ê°€ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            // ê²°ê³¼ë¥¼ í•´ë‹¹ ì…ë ¥ í•„ë“œì— ì ìš©
            const targetInput = document.getElementById(currentCalculatorTarget);
            if (targetInput) {
                targetInput.value = result.toFixed(2);
            }
            
            closeCalculator();
        }

        // í‰ê·  ì ìˆ˜ ì €ì¥ í•¨ìˆ˜ë“¤
        function saveAverage(type, value) {
            const numValue = parseFloat(value);
            if (numValue > 0) {
                savedAverages[type] = numValue;
                updateSavedAveragesDisplay();
                autoFillAverages();
            }
        }

        function clearAverage(type) {
            savedAverages[type] = null;
            document.getElementById(`saved-${type === 'englishListening' ? 'listening' : type}-avg`).value = '';
            updateSavedAveragesDisplay();
        }

        function clearAllAverages() {
            if (confirm('ì €ì¥ëœ ëª¨ë“  í‰ê·  ì ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                savedAverages = {
                    midterm: null,
                    final: null,
                    performance: {},
                    englishListening: null,
                    performance1: null,
                    performance2: null,
                    performance3: null
                };
                savedPerformanceAreaNames = {
                    performance1: null,
                    performance2: null,
                    performance3: null
                };
                document.getElementById('saved-midterm-avg').value = '';
                document.getElementById('saved-final-avg').value = '';
                document.getElementById('saved-listening-avg').value = '';
                document.getElementById('saved-performance1-avg').value = '';
                document.getElementById('saved-performance2-avg').value = '';
                document.getElementById('saved-performance3-avg').value = '';
                document.getElementById('saved-performance1-name').value = '';
                document.getElementById('saved-performance2-name').value = '';
                document.getElementById('saved-performance3-name').value = '';
                updatePerformanceAreaTitles();
                updateSavedAveragesDisplay();
                alert('ëª¨ë“  í‰ê·  ì ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function savePerformanceAreaName(areaType, name) {
            if (name && name.trim()) {
                savedPerformanceAreaNames[areaType] = name.trim();
                updatePerformanceAreaTitles();
            }
        }
        
        function clearPerformanceArea(areaType) {
            savedAverages[areaType] = null;
            savedPerformanceAreaNames[areaType] = null;
            document.getElementById(`saved-${areaType}-avg`).value = '';
            document.getElementById(`saved-${areaType}-name`).value = '';
            updatePerformanceAreaTitles();
            updateSavedAveragesDisplay();
        }
        
        function updatePerformanceAreaTitles() {
            ['performance1', 'performance2', 'performance3'].forEach(areaType => {
                const titleElement = document.getElementById(`${areaType}-title`);
                const savedName = savedPerformanceAreaNames[areaType];
                if (savedName) {
                    titleElement.textContent = savedName;
                } else {
                    const defaultNames = {
                        'performance1': 'ìˆ˜í–‰í‰ê°€ 1',
                        'performance2': 'ìˆ˜í–‰í‰ê°€ 2',
                        'performance3': 'ìˆ˜í–‰í‰ê°€ 3'
                    };
                    titleElement.textContent = defaultNames[areaType];
                }
            });
        }

        function savePerformanceAverage(subject, areaName, value) {
            if (!savedAverages.performance[subject]) {
                savedAverages.performance[subject] = {};
            }
            savedAverages.performance[subject][areaName] = parseFloat(value);
            updateSavedAveragesDisplay();
        }

        function clearPerformanceAverage(subject, areaName) {
            if (savedAverages.performance[subject]) {
                delete savedAverages.performance[subject][areaName];
                if (Object.keys(savedAverages.performance[subject]).length === 0) {
                    delete savedAverages.performance[subject];
                }
            }
            updateSavedAveragesDisplay();
        }

        function updateSavedAveragesDisplay() {
            // ìˆ˜í–‰í‰ê°€ í‰ê·  ê´€ë¦¬ ê¸°ëŠ¥ ì œê±°ë¨
        }

        function autoFillAverages() {
            // ì¤‘ê°„ê³ ì‚¬ í‰ê·  ìë™ ì…ë ¥
            if (savedAverages.midterm) {
                const midtermAvgInput = document.getElementById('midterm-avg');
                if (midtermAvgInput && !midtermAvgInput.value) {
                    midtermAvgInput.value = savedAverages.midterm;
                }
            }

            // ê¸°ë§ê³ ì‚¬ í‰ê·  ìë™ ì…ë ¥
            if (savedAverages.final) {
                const finalAvgInput = document.getElementById('final-avg');
                if (finalAvgInput && !finalAvgInput.value) {
                    finalAvgInput.value = savedAverages.final;
                }
            }

            // ì˜ì–´ë“£ê¸° í‰ê·  ìë™ ì…ë ¥
            if (savedAverages.englishListening) {
                const listeningAvgInput = document.getElementById('listening-avg');
                if (listeningAvgInput && !listeningAvgInput.value) {
                    listeningAvgInput.value = savedAverages.englishListening;
                }
            }

            // ìˆ˜í–‰í‰ê°€ í‰ê·  ìë™ ì…ë ¥
            const currentSubject = document.getElementById('student-subject').value;
            if (currentSubject && savedAverages.performance[currentSubject]) {
                const absentPerfAvgInput = document.getElementById('absent-performance-avg');
                const absentPerfNameInput = document.getElementById('absent-performance-name');
                
                if (absentPerfAvgInput && absentPerfNameInput && absentPerfNameInput.value) {
                    const areaName = absentPerfNameInput.value;
                    if (savedAverages.performance[currentSubject][areaName]) {
                        absentPerfAvgInput.value = savedAverages.performance[currentSubject][areaName];
                    }
                }
            }
        }



        // ìƒˆë¡œìš´ ê³„ì‚°ê¸° í•¨ìˆ˜ë“¤
        function addStudentArea() {
            const container = document.getElementById('student-areas-container');
            if (container.children.length >= 4) {
                alert('ìµœëŒ€ 4ê°œ ì˜ì—­ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const newItem = document.createElement('div');
            newItem.className = 'student-area-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í•™ìƒì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updateStudentAreas()">
                <button type="button" onclick="removeStudentArea(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
        }

        function removeStudentArea(button) {
            const container = document.getElementById('student-areas-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateStudentAreas();
            }
        }

        function updateStudentAreas() {
            const container = document.getElementById('student-areas-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('student-areas-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        function addClassArea() {
            const container = document.getElementById('class-areas-container');
            if (container.children.length >= 4) {
                alert('ìµœëŒ€ 4ê°œ ì˜ì—­ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const newItem = document.createElement('div');
            newItem.className = 'class-area-item flex items-center space-x-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="ì˜ì—­ëª… (ì˜ˆ: ì“°ê¸°)" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <input type="number" step="0.1" placeholder="í‰ê· ì ìˆ˜" 
                       class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm" 
                       oninput="updateClassAreas()">
                <button type="button" onclick="removeClassArea(this)" 
                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                    ì‚­ì œ
                </button>
            `;
            container.appendChild(newItem);
        }

        function removeClassArea(button) {
            const container = document.getElementById('class-areas-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateClassAreas();
            }
        }

        function updateClassAreas() {
            const container = document.getElementById('class-areas-container');
            const scoreInputs = container.querySelectorAll('input[type="number"]');
            const resultSpan = document.getElementById('class-areas-result');
            
            let total = 0;
            let count = 0;
            
            scoreInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (value > 0) {
                    total += value;
                    count++;
                }
            });
            
            if (count > 0) {
                const avg = total / count;
                resultSpan.textContent = avg.toFixed(2);
            } else {
                resultSpan.textContent = '-';
            }
        }

        // ê³„ì‚° ê³µì‹ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openFormulaModal() {
            document.getElementById('formula-modal').classList.remove('hidden');
        }

        function closeFormulaModal() {
            document.getElementById('formula-modal').classList.add('hidden');
        }

        // ê¸°ì¡´ ìˆ˜í–‰í‰ê°€ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ ìˆ˜í–‰í‰ê°€ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            setTimeout(() => {
                const firstScoreInput = document.querySelector('#performance-scores-container input[type="number"]');
                if (firstScoreInput) {
                    firstScoreInput.addEventListener('input', updatePerformanceAvg);
                }
                
                const firstStudentScoreInput = document.querySelector('#student-performance-scores-container input[type="number"]');
                if (firstStudentScoreInput) {
                    firstStudentScoreInput.addEventListener('input', updateStudentPerformanceAvg);
                }
            }, 100);
            
            // ì €ì¥ëœ í‰ê·  í‘œì‹œ ì´ˆê¸°í™”
            updateSavedAveragesDisplay();
            updatePerformanceAreaTitles();
        });
    </script>
</body>
</html>
